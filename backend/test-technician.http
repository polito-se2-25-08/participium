### Technician Flow Test
### Adjust tokens / IDs after running each step.

@baseUrl = http://localhost:3000/api
@adminUsername = admDom
@adminPassword = Ud5S4*9MPe
@adminToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MzAsInJvbGUiOiJBRE1JTiIsImlhdCI6MTc2NDA2NjgxOSwiZXhwIjoxNzY0MDcwNDE5fQ.QNpd0nYbd8-SkDzkxSuDXXpipoRDUESBPHYIcDjBjCM

@techUsername = tech_user_cat5
@techEmail = tech_user_cat5@example.com
# Fill after creation response:
@techUserId = 42
@techPassword = [hLeT3:K)d$
@techToken = eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6NDIsInJvbGUiOiJURUNITklDSUFOIiwiaWF0IjoxNzY0MDY3MDE2LCJleHAiOjE3NjQwNzA2MTZ9.jfEny-FO9VYmNMGN98E3cXWbrn58JZ1bwZJsbJMEiqI


###############################################
# 0. Login and Get JWT Token
###############################################
# @name login
POST {{baseUrl}}/v1/login
Content-Type: application/json

{
  "username": "{{adminUsername}}",
  "password": "{{adminPassword}}"
}

############################################################
# 1. Admin creates a TECHNICIAN user (password returned)
############################################################
POST {{baseUrl}}/v1/admin/register
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "email": "{{techEmail}}",
  "username": "{{techUsername}}",
  "role": "TECHNICIAN",
  "name": "Tech",
  "surname": "User"
}

### After this, copy:
### - data.id -> @techUserId
### - data.password (plain) -> @techPassword

############################################################
# 2. Admin assigns category to technician (e.g. category_id = 5)
############################################################
PUT {{baseUrl}}/v1/admin/technicians/{{techUserId}}/category
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "category_id": 5
}

### Error case: invalid category (e.g. 0)
PUT {{baseUrl}}/v1/admin/technicians/{{techUserId}}/category
Authorization: Bearer {{adminToken}}
Content-Type: application/json

{
  "category_id": 0
}

############################################################
# 3. Technician login to obtain JWT
############################################################
# @name technicianLogin
POST {{baseUrl}}/v1/login
Content-Type: application/json

{
  "username": "{{techUsername}}",
  "password": "{{techPassword}}"
}

### Copy returned token -> @techToken

############################################################
# 4. Technician fetch reports for their category (default status = ASSIGNED)
############################################################
GET {{baseUrl}}/v1/technician/reports
Authorization: Bearer {{techToken}}

### With explicit status filter
GET {{baseUrl}}/v1/technician/reports?status=IN_PROGRESS
Authorization: Bearer {{techToken}}

### With explicit status filter
GET {{baseUrl}}/v1/technician/reports?status=SUSPENDED
Authorization: Bearer {{techToken}}

### With explicit status filter
GET {{baseUrl}}/v1/technician/reports?status=RESOLVED
Authorization: Bearer {{techToken}}

### With explicit status filter
GET {{baseUrl}}/v1/technician/reports?status=REJECTED
Authorization: Bearer {{techToken}}

### Error: missing token
GET {{baseUrl}}/v1/technician/reports

### Error: wrong role (use a CITIZEN token)
GET {{baseUrl}}/v1/technician/reports
Authorization: Bearer <CITIZEN_TOKEN>

############################################################
# (Optional) NEEDS VERIFICATION Seed reports (requires existing report creation route)
# Ensure some reports exist with category_id = 5 and status = ASSIGNED / IN_PROGRESS
############################################################
#POST {{baseUrl}}/v1/reports
#Authorization: Bearer {{adminToken}}
#Content-Type: application/json
#{
#  "title": "Broken streetlight",
#  "description": "Lamp not working",
#  "latitude": "45.067",
#  "longitude": "7.682",
#  "anonymous": false,
#  "category_id": 5
#}